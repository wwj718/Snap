<blocks app="Snap! 8.1, https://snap.berkeley.edu" version="2"><palette><category name="CodeLab Adapter" color="0,116,143,1"/></palette><block-definition s="help" type="command" category="CodeLab Adapter"><comment x="0" y="0" w="90" collapsed="false">点击查看帮助文档</comment><header></header><code></code><translations></translations><inputs></inputs><script><block s="doApplyExtension"><l>eim_openurl(url)</l><list><l>https://adapter.codelab.club/extension_guide/eim/</l></list></block></script></block-definition><block-definition s="open Adapter Web UI" type="command" category="CodeLab Adapter"><comment x="0" y="0" w="90" collapsed="false">需要从Adapter打开Snap， 这个按钮才可用</comment><header></header><code></code><translations></translations><inputs></inputs><script><block s="doDeclareVariables"><list><l>url</l></list></block><block s="doIf"><block s="reportEquals"><block s="reportApplyExtension"><l>eim_token</l><list></list></block><l></l></block><script><block s="doApplyExtension"><l>err_error(msg)</l><list><l>未在 url 找到 token</l></list></block></script></block><block s="doSetVar"><l>url</l><block s="reportJoinWords"><list><l>https://codelab-adapter.codelab.club:12358/?adapter_token=</l><block s="reportApplyExtension"><l>eim_token</l><list></list></block></list></block></block><block s="doApplyExtension"><l>eim_openurl(url)</l><list><block var="url"/></list></block></script></block-definition><block-definition s="is Adapter running?" type="predicate" category="CodeLab Adapter"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doReport"><block s="reportApplyExtension"><l>eim_running?</l><list></list></block></block></script></block-definition><block-definition s="set wait timeout %&apos;timeout&apos; s" type="command" category="CodeLab Adapter"><header></header><code></code><translations></translations><inputs><input type="%n">5</input></inputs><script><block s="doApplyExtension"><l>eim_timeout(timeout)</l><list><block var="timeout"/></list></block></script></block-definition><block-definition s="%&apos;content&apos; received?" type="predicate" category="CodeLab Adapter"><header></header><code></code><translations></translations><inputs><input type="%txt">hello<options>any</options></input></inputs><script><block s="doReport"><custom-block s="topic: %txt message: %txt received?"><l>any</l><block var="content"/></custom-block></block></script></block-definition><block-definition s="received message" type="reporter" category="CodeLab Adapter"><header></header><code></code><translations></translations><inputs></inputs><script><block s="doDeclareVariables"><list><l>variable</l><l>content</l></list></block><block s="doIf"><block s="reportEquals"><block s="reportApplyExtension"><l>eim_msg</l><list></list></block><l>{}</l></block><script><block s="doReport"><l></l></block></script></block><block s="doReport"><block s="reportPipe"><block s="reportApplyExtension"><l>eim_msg</l><list></list></block><list><block s="reifyReporter"><autolambda><block s="reportTextSplit"><l></l><l><option>json</option></l></block></autolambda><list></list></block><block s="reifyReporter"><autolambda><block s="reportListItem"><l>message</l><l/></block></autolambda><list></list></block><block s="reifyReporter"><autolambda><block s="reportListItem"><l>payload</l><l/></block></autolambda><list></list></block><block s="reifyReporter"><autolambda><block s="reportListItem"><l>content</l><l/></block></autolambda><list></list></block></list></block></block></script></block-definition><block-definition s="broadcast %&apos;content&apos; and wait" type="command" category="CodeLab Adapter"><header></header><code></code><translations></translations><inputs><input type="%txt">hello</input></inputs><script><custom-block s="broadcast %txt %txt and wait"><l>eim</l><block var="content"/></custom-block></script></block-definition><block-definition s="broadcast %&apos;content&apos;" type="command" category="CodeLab Adapter"><header></header><code></code><translations></translations><inputs><input type="%txt">hello</input></inputs><script><custom-block s="broadcast %txt %txt"><l>eim</l><block var="content"/></custom-block></script></block-definition><block-definition s="broadcast %&apos;content&apos; and wait ." type="reporter" category="CodeLab Adapter"><header></header><code></code><translations></translations><inputs><input type="%txt">hello</input></inputs><script><block s="doReport"><custom-block s="broadcast %txt %txt and wait ."><l>eim</l><block var="content"/></custom-block></block></script></block-definition><block-definition s="%&apos;content&apos; %&apos;ext_name&apos;" type="command" category="CodeLab Adapter"><header></header><code></code><translations></translations><inputs><input type="%s" readonly="true">start<options>start&#xD;stop</options></input><input type="%txt">extension_python<options>extension_usb_microbit&#xD;extension_microbit_radio&#xD;extension_jupyterlab&#xD;extension_python&#xD;extension_NetworkZero&#xD;extension_arduino_uno&#xD;extension_simple_pyboard&#xD;extension_uart_adapter&#xD;extension_Yanshee&#xD;extension_Siri&#xD;extension_webserver&#xD;extension_webUI_manager&#xD;extension_stage&#xD;extension_wechat</options></input></inputs><script><block s="doApplyExtension"><l>eim_controlext(content, ext)</l><list><block var="content"/><block var="ext_name"/></list></block></script><scripts><comment x="193.84615384615384" y="100.15384615384615" w="168.46153846153845" collapsed="false">下拉菜单，adapter消息来的时候，勾到某个积木，更新积木外观，</comment></scripts></block-definition><block-definition s="is %&apos;ext_name&apos; turned on?" type="predicate" category="CodeLab Adapter"><header></header><code></code><translations></translations><inputs><input type="%txt">extension_python<options>extension_usb_microbit&#xD;extension_microbit_radio&#xD;extension_jupyterlab&#xD;extension_python&#xD;extension_NetworkZero&#xD;extension_arduino_uno&#xD;extension_simple_pyboard&#xD;extension_uart_adapter&#xD;extension_Yanshee&#xD;extension_Siri&#xD;extension_webserver&#xD;extension_webUI_manager&#xD;extension_stage&#xD;extension_wechat</options></input></inputs><script><block s="doReport"><block s="reportPipe"><block s="reportApplyExtension"><l>eim_extstate</l><list></list></block><list><block s="reifyReporter"><autolambda><block s="reportTextSplit"><l></l><l><option>json</option></l></block></autolambda><list></list></block><block s="reifyReporter"><autolambda><block s="reportListItem"><block var="ext_name"/><l/></block></autolambda><list></list></block><block s="reifyReporter"><autolambda><block s="reportListItem"><l>is_running</l><l/></block></autolambda><list></list></block></list></block></block></script></block-definition><block-definition s="%&apos;content&apos; %&apos;node_name&apos; ." type="command" category="CodeLab Adapter"><header></header><code></code><translations></translations><inputs><input type="%s" readonly="true">start<options>start&#xD;stop</options></input><input type="%txt">node_physical_blocks2<options>node_cozmo&#xD;node_physical_blocks2&#xD;node_vector&#xD;node_HCI&#xD;node_minecraft&#xD;node_yeelight&#xD;node_RoboMasterEP2&#xD;node_status_bar_win&#xD;node_motionSensor_gesture&#xD;node_adapterMario&#xD;node_motionSensor_proximity&#xD;node_spheroRVR&#xD;node_ledbag&#xD;node_brainCo&#xD;node_overdrive2&#xD;node_overdrive&#xD;node_status_bar_mac&#xD;node_tello3&#xD;node_raspberrypi&#xD;node_yeelight_2&#xD;node_sonicPi&#xD;node_alphamini&#xD;node_digimon</options></input></inputs><script><block s="doApplyExtension"><l>eim_controlnode(content, node)</l><list><block var="content"/><block var="node_name"/></list></block></script></block-definition><block-definition s="is %&apos;node_name&apos; turned on? ." type="predicate" category="CodeLab Adapter"><header></header><code></code><translations></translations><inputs><input type="%txt">node_physical_blocks2<options>node_cozmo&#xD;node_physical_blocks2&#xD;node_vector&#xD;node_HCI&#xD;node_minecraft&#xD;node_yeelight&#xD;node_RoboMasterEP2&#xD;node_status_bar_win&#xD;node_motionSensor_gesture&#xD;node_adapterMario&#xD;node_motionSensor_proximity&#xD;node_spheroRVR&#xD;node_ledbag&#xD;node_brainCo&#xD;node_overdrive2&#xD;node_overdrive&#xD;node_status_bar_mac&#xD;node_tello3&#xD;node_raspberrypi&#xD;node_yeelight_2&#xD;node_sonicPi&#xD;node_alphamini&#xD;node_digimon</options></input></inputs><script><block s="doReport"><block s="reportPipe"><block s="reportApplyExtension"><l>eim_nodesstate</l><list></list></block><list><block s="reifyReporter"><autolambda><block s="reportTextSplit"><l></l><l><option>json</option></l></block></autolambda><list></list></block><block s="reifyReporter"><autolambda><block s="reportListItem"><block var="node_name"/><l/></block></autolambda><list></list></block><block s="reifyReporter"><autolambda><block s="reportListItem"><l>is_running</l><l/></block></autolambda><list></list></block></list></block></block></script></block-definition><block-definition s="topic: %&apos;topic&apos; message: %&apos;message&apos; received?" type="predicate" category="CodeLab Adapter"><variables><list struct="atomic" id="248">old,old_time</list></variables><header></header><code></code><translations></translations><inputs><input type="%txt">eim/extension_python<options>any</options></input><input type="%txt">3<options>any</options></input></inputs><script><block s="doDeclareVariables"><list><l>last_topic</l><l>last_message</l><l>last_time</l></list></block><block s="doIf"><block s="reportNot"><custom-block s="is Adapter running?"></custom-block></block><script><block s="doReport"><block s="reportBoolean"><l><bool>false</bool></l></block></block></script></block><block s="doIf"><block s="reportEquals"><block s="reportApplyExtension"><l>eim_msg</l><list></list></block><l>{}</l></block><script><block s="doReport"><block s="reportBoolean"><l><bool>false</bool></l></block></block></script></block><block s="doSetVar"><l>last_message</l><custom-block s="received message"></custom-block></block><block s="doSetVar"><l>last_topic</l><block s="reportPipe"><block s="reportApplyExtension"><l>eim_msg</l><list></list></block><list><block s="reifyReporter"><autolambda><block s="reportTextSplit"><l></l><l><option>json</option></l></block></autolambda><list></list></block><block s="reifyReporter"><autolambda><block s="reportListItem"><l>message</l><l/></block></autolambda><list></list></block><block s="reifyReporter"><autolambda><block s="reportListItem"><l>payload</l><l/></block></autolambda><list></list></block><block s="reifyReporter"><autolambda><block s="reportListItem"><l>node_id</l><l/></block></autolambda><list></list></block></list></block></block><block s="doSetVar"><l>last_time</l><block s="reportApplyExtension"><l>eim_msgtime</l><list></list></block></block><block s="doIf"><block s="reportAnd"><block s="reportGreaterThan"><block var="last_time"/><block var="old_time"/></block><block s="reportAnd"><block s="reportOr"><block s="reportEquals"><block var="topic"/><block var="last_topic"/></block><block s="reportEquals"><block var="topic"/><l>any</l></block></block><block s="reportOr"><block s="reportEquals"><block var="message"/><block var="last_message"/></block><block s="reportEquals"><block var="message"/><l>any</l></block></block></block></block><script><block s="doSetVar"><l>old_time</l><block var="last_time"/></block><block s="doReport"><block s="reportBoolean"><l><bool>true</bool></l></block></block></script></block><block s="doReport"><block s="reportBoolean"><l><bool>false</bool></l></block></block></script></block-definition><block-definition s="received %&apos;node_id&apos; message" type="reporter" category="CodeLab Adapter"><header></header><code></code><translations></translations><inputs><input type="%txt">eim/extension_python</input></inputs><script><block s="doIf"><block s="reportEquals"><block s="reportApplyExtension"><l>eim_msg</l><list></list></block><l>{}</l></block><script><block s="doReport"><l></l></block></script></block><block s="doIfElse"><block s="reportEquals"><block var="node_id"/><block s="reportPipe"><block s="reportApplyExtension"><l>eim_msg</l><list></list></block><list><block s="reifyReporter"><autolambda><block s="reportTextSplit"><l></l><l><option>json</option></l></block></autolambda><list></list></block><block s="reifyReporter"><autolambda><block s="reportListItem"><l>message</l><l/></block></autolambda><list></list></block><block s="reifyReporter"><autolambda><block s="reportListItem"><l>payload</l><l/></block></autolambda><list></list></block><block s="reifyReporter"><autolambda><block s="reportListItem"><l>node_id</l><l/></block></autolambda><list></list></block></list></block></block><script><block s="doReport"><block s="reportPipe"><block s="reportApplyExtension"><l>eim_msg</l><list></list></block><list><block s="reifyReporter"><autolambda><block s="reportTextSplit"><l></l><l><option>json</option></l></block></autolambda><list></list></block><block s="reifyReporter"><autolambda><block s="reportListItem"><l>message</l><l/></block></autolambda><list></list></block><block s="reifyReporter"><autolambda><block s="reportListItem"><l>payload</l><l/></block></autolambda><list></list></block><block s="reifyReporter"><autolambda><block s="reportListItem"><l>content</l><l/></block></autolambda><list></list></block></list></block></block></script><script><block s="doReport"><l></l></block></script></block></script></block-definition><block-definition s="broadcast %&apos;node_id&apos; %&apos;content&apos; and wait" type="command" category="CodeLab Adapter"><header></header><code></code><translations></translations><inputs><input type="%txt">eim/extension_python</input><input type="%txt">1+2</input></inputs><script><custom-block s="ignore %s"><custom-block s="broadcast %txt %txt and wait ."><block var="node_id"/><block var="content"/></custom-block></custom-block></script></block-definition><block-definition s="broadcast %&apos;node_id&apos; %&apos;content&apos;" type="command" category="CodeLab Adapter"><header></header><code></code><translations></translations><inputs><input type="%txt">eim/extension_python</input><input type="%txt">1+2</input></inputs><script><block s="doApplyExtension"><l>eim_broadcast(node_id, content)</l><list><block var="node_id"/><block var="content"/></list></block></script></block-definition><block-definition s="broadcast %&apos;node_id&apos; %&apos;content&apos; and wait ." type="reporter" category="CodeLab Adapter"><header></header><code></code><translations></translations><inputs><input type="%txt">eim/extension_python</input><input type="%txt">1+2</input></inputs><script><block s="doDeclareVariables"><list><l>isDone</l><l>reply</l></list></block><block s="doApplyExtension"><l>eim_broadcastwait(node_id, content)</l><list><block var="node_id"/><block var="content"/></list><comment w="196.15384615384616" collapsed="false">通过修改变量来做，而不是 promise</comment></block><block s="doWaitUntil"><block var="isDone"/></block><block s="doReport"><block var="reply"/></block></script></block-definition><block-definition s="trust adapter host %&apos;adapter_host&apos;" type="command" category="CodeLab Adapter"><header></header><code></code><translations></translations><inputs><input type="%txt">codelab-adapter.codelab.club</input></inputs><script><block s="doRun"><block s="reportJSFunction"><list><l>adapter_host</l></list><l>&#xD;        window.open(`https://${adapter_host}:12358`);</l></block><list><block var="adapter_host"/></list></block></script></block-definition><block-definition s="ignore %&apos;x&apos;" type="command" category="control"><comment x="0" y="0" w="206.66666666666669" collapsed="false">This block does nothing.&#xD;Use it when you are calling a reporter&#xD;for its side effect and don&apos;t care about&#xD;its return value.</comment><header></header><code></code><translations>de:ignoriere _&#xD;ca:ignora _&#xD;es:ignorar _&#xD;fr:ignore _&#xD;pt:ignora _&#xD;</translations><inputs><input type="%s"></input></inputs></block-definition></blocks>